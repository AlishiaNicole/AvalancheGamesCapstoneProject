
@{
    ViewBag.Title = "PongBall";
}

<h2>PongBall</h2>

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>PongBall</title>
</head>
<body>
    <div>
        <p>Score: <span>0</span></p>
        <canvas></canvas>
    </div>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        p {
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            font-size: 2rem;
            color: #ffffff;
            -webkit-font-smoothing: antialiased;
            position: absolute;
            top: 20px;
            left: 20px;
        }
    </style>
    <script>
        document.addEventListener("DOMContentLoaded", loadCanvas);

        var m = {
            ym: false,
            xm: true,
            xb: 0,
            yb: 0,
            pm: null,
            xPos: 500 / 2 - 75,
            yPos: 300 - 24
        }

        function loadCanvas() {
            var canvas = s("canvas");
            var context = canvas.getContext("2d");

            context.clearRect(0, 0, 500, 300);

            canvas.width = 500;
            canvas.height = 300;

            canvas.style.width = 300;
            canvas.style.height = 300;

            //background
            context.fillStyle = "#00FFFF";
            context.fillRect(0, 0, 500, 300);

            //ball
            context.fillStyle = "#FFFFFF";
            context.fillRect(m.xb, m.yb, 15, 15);

            //player
            context.fillStyle = "#FFFFFF";
            context.fillRect(m.xPos, m.yPos, 150, 12);
            
            //listen for keyboard press
            document.addEventListener("keydown", function (e) {
                if (e.keyCode === 37) m.pm = false;
                else if (e.keyCode === 38) m.pm = false;
                else if (e.keyCode === 39) m.pm = true;
                else if (e.keyCode === 40) m.pm = true;
                else m.pm = null;
            });

            //collision detection
            if (m.xb > m.xPos - 12 && m.xb < m.xPos + 150) {
                if (m.yb === m.yPos - 6) {
                    m.ym = true;
                    s("p span").innerHTML = parseInt(s("p span").innerHTML) + 1;
                }
            }

            //ball x movement
            if (m.xm === false) {
                if (m.xb === 500 - 12) {
                    m.xm = true;
                } else {
                    m.xb++;
                }
            } else if (m.xm === true) {
                if (m.xb === 0) {
                    m.xm = false;
                } else {
                    m.xb--;
                }
            }

            //ball y movement
            if (m.ym === false) {
                if (m.yb === 300 - 12) {
                    var score = s("p span").innerHTML;
                    s("p").innerHTML = "GAME OVER!";
                    setTimeout(function () {
                        //window.location.href = window.location;
                        window.location.href = ('/Game/PongBallResult/' + score);
                    }, 3000);
                    return;
                } else {
                    m.yb++;
                }
            } else if (m.ym === true) {
                if (m.yb === 0) {
                    m.ym = false;
                } else {
                    m.yb--;
                }
            }

            if (m.pm === false) {
                if (m.xPos !== 0) m.xPos--;
                else m.xPos = 0;
            } else if (m.pm === true) {
                if (m.xPos !== 500 - 150) m.xPos++;
                else m.xPos = 500 - 150;
            }

            setTimeout(loadCanvas, 4);
        }

        function s(e) {
            return document.querySelector(e);
        }
    </script>
</body>
</html>
